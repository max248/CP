<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>Admin - Dashboard</title>
    <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTgpEB0pwwB8BKgqs5msjHFdboMiy8LCFKKlQ&usqp=CAU">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- site icon -->
    <link rel="icon" th:href="@{img/itransition.jpg}" type="image/png"/>
    <!-- bootstrap css -->
    <link rel="stylesheet" th:href="@{css/bootstrap.min.css}"/>
    <!-- site css -->
    <link rel="stylesheet" th:href="@{css/style.css}"/>
    <!-- responsive css -->
    <link rel="stylesheet" th:href="@{css/responsive.css}"/>
    <!-- color css -->
    <!--    <link rel="stylesheet" th:href="@{css/colors.css}" />-->
    <!-- select bootstrap -->
    <link rel="stylesheet" th:href="@{css/bootstrap-select.css}"/>
    <!-- scrollbar css -->
    <link rel="stylesheet" th:href="@{css/perfect-scrollbar.css}"/>
    <!-- custom css -->
    <link rel="stylesheet" th:href="@{css/custom.css}"/>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script th:src="@{js/popper.min.js}"></script>
    <script th:src="@{js/bootstrap.min.js}"></script>
    <!-- wow animation -->
    <script th:src="@{js/animate.js}"></script>
    <!-- select country -->
    <script th:src="@{js/bootstrap-select.js}"></script>
    <!-- owl carousel -->
    <script th:src="@{js/owl.carousel.js}"></script>
    <!-- nice scrollbar -->
    <script th:src="@{js/perfect-scrollbar.min.js}"></script>
    <script>
        var ps = new PerfectScrollbar('#sidebar');
    </script>
    <!-- custom js -->
    <script th:src="@{js/custom.js}"></script>
    <!-- <script src="js/chart_custom_style1.js"></script> -->
    <![endif]-->
</head>
<body class="dashboard dashboard_1">
<div class="full_container">
    <div class="inner_container">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar_blog_1">
                <div class="sidebar-header">
                    <div class="logo_section">
                        <a href="#"><img class="logo_icon img-responsive" src="/img/itransition.jpg" alt="/admin_panel"/></a>
                    </div>
                </div>
                <div class="sidebar_user_info">
                    <div class="icon_setting"></div>
                    <div class="user_profle_side">
                        <div class="user_img"><img class="img-responsive" src="/img/user_img.jpg" alt="#"/></div>
                        <div class="user_info">
                            <h6><label th:text="${username}"/></h6>
                            <p><span class="online_animation"></span> Online</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar_blog_2">
                <h4>General</h4>
                <ul class="list-unstyled components">
                    <li><a th:href="@{/list_users}"><i class="fa fa-users" aria-hidden="true"></i> <span>Users</span></a></li>
                    <li><a th:href="@{/topic_settings}"><i class="fa fa-list"></i> <span>Topics</span></a></li>
                    <li><a th:href="@{/collection_settings}"><i class="fa fa-outdent"></i> <span>Collections</span></a></li>
                    <li><a href="#"><i class="fa fa-align-left" aria-hidden="true"></i> <span>Items</span></a></li>
                    <li><a href="#"><i class="fa fa-slack" aria-hidden="true"></i> <span>Tags</span></a></li>
                </ul>
            </div>
        </nav>
        <!-- end sidebar -->
        <!-- right content -->
        <div id="content">
            <!-- topbar -->
            <div class="topbar">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="full">
                        <button type="button" id="sidebarCollapse" class="sidebar_toggle"><i class="fa fa-bars"></i>
                        </button>
                        <div class="right_topbar">
                            <div class="icon_info">
                                <ul class="user_profile_dd">
                                    <li>
                                        <a class="dropdown-toggle" data-toggle="dropdown"><img
                                                class="img-responsive rounded-circle" src="/img/user_img.jpg"
                                                alt="#"/><span class="name_user" th:text="${username}"></span></a>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="/user_profil">My Profile</a>
                                            <a class="dropdown-item" href="/logout"><span>Log Out</span> <i
                                                    class="fa fa-sign-out"></i></a>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            <!-- end topbar -->
            <!-- dashboard inner -->
            <div class="midde_cont">
                <div class="container-fluid">
                    <div class="row column_title">
                        <div class="col-md-12">
                            <div class="page_title">
                                <h2>Dashboard</h2>
                            </div>
                        </div>
                    </div>
                    <div class="row column1">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="w-100 px-2">
                                    <br><br>
                                    <h1 class="mb-0 h4 text-center">List of All Users</b></h1>
                                    <div class="container">
                                        <!--Grid row-->
                                        <div class="row">
                                            <!--Grid column-->
                                            <div class="col-md-12 mb-12">
                                                <!--Section: Post data-mdb-->
                                                <section class="border-bottom mb-8 text-center">
                                                    <div class="tableFixHead">
                                                        <table class="table table-fixed" id="myTable">
                                                            <thead>
                                                            <tr>
                                                                <th style="width: 2%";><input type="checkbox" name="select-all" id="select-all" /></th>
                                                                <th style="width: 10%;">User ID</th>
                                                                <th style="width: 20%;">E-mail</th>
                                                                <th style="width: 30%;">Name</th>
                                                                <th style="width: 15%;">Reg Date</th>
                                                                <th style="width: 15%;">Last Login Date</th>
                                                                <th style="width: 10%;">Status</th>
                                                                <th style="width: 10%;">Role</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody id="bodyTable">
                                                            <tr th:each="user: ${listUser}">
                                                                <td><input type="checkbox" name="checkedIds" th:value="${user.id}"></td>
                                                                <td th:text="${user.id}">USER ID</td>
                                                                <td th:text="${user.email}">Email</td>
                                                                <td th:text="${user.fullName}">Name</td>
                                                                <td th:text="${user.regDate}">Reg Date</td>
                                                                <td th:text="${user.lastLoginDate}">Last Login Date</td>
                                                                <td th:text="${user.enabled}">Status</td>
                                                                <td th:text="${user.role.getName()}">Role</td>
                                                            </tr>
                                                            </tbody>

                                                        </table>
                                                    </div>
                                                    <button class="btn btn-primary" id="block" onclick="setBlockStatus(false)">Block</button>
                                                    <button class="btn btn-secondary" id="unblock" onclick="setBlockStatus(true)">Unblock</button>
                                                    <button class="btn btn-secondary" id="admin" onclick="setRoleId(2)">Admin</button>
                                                    <button class="btn btn-secondary" id="user" onclick="setRoleId(1)">User</button>
                                                    <button class="btn btn-danger" id="delete" onclick="deleteUser()">Delete</button>
                                                </section>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- footer -->
                    <div class="container-fluid">
                        <div class="footer">
                            <p>Copyright © 2018 Designed by html.design. All rights reserved.<br><br>
                                Distributed By: <a href="#">ThemeWagon</a>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- end dashboard inner -->
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    $('#select-all').click(function(event) {
        if(this.checked) {
            $(':checkbox').each(function() {
                if(!this.disabled){
                    this.checked = true;
                }
            });
        } else {
            $(':checkbox').each(function() {
                if(!this.disabled){
                    this.checked = false;
                }
            });
        }
    });
    function setBlockStatus(status){
        var checkedValues = [];
        $.each($("input[name='checkedIds']:checked"), function(){
            checkedValues.push($(this).val());
        });
        var data = 'id=' + checkedValues + '&flag=' + status;
        $.ajax({
            url:"/block",
            type: "POST",
            data: data,
            success: function (response){
                if(response == 'login'){
                    window.location.href = "/login";
                    return;
                }
                $("#myTable > tbody").html("");
                $('#select-all').prop('checked', false);
                for(var i=0;i<response.length;i++){
                    $('#myTable tbody').append('<tr>' +
                        '<td><input type="checkbox" name="checkedIds" value="'+ response[i].id +'"></td>' +
                        '<td>' + response[i].id + '</td>' +
                        '<td>' + response[i].email + '</td>' +
                        '<td>' + response[i].firstName + ' ' + response[i].lastName + '</td>' +
                        '<td>' + response[i].regDate + '</td>' +
                        '<td>' + response[i].lastLoginDate + '</td>' +
                        '<td>' + response[i].enabled + '</td>' +
                        '<td>' + response[i].role.name + '</td>' +
                        '</tr>');
                }
            },
            error: function (error){
                console.log("error: " + error);
            }
        })
    }
    function setRoleId(roleId){
        var checkedValues = [];
        $.each($("input[name='checkedIds']:checked"), function(){
            checkedValues.push($(this).val());
        });
        var data = 'id=' + checkedValues + '&roleId=' + roleId;
        $.ajax({
            url:"/role",
            type: "POST",
            data: data,
            success: function (response){
                if(response == 'login'){
                    window.location.href = "/login";
                    return;
                }
                $("#myTable > tbody").html("");
                $('#select-all').prop('checked', false);
                for(var i=0;i<response.length;i++){
                    $('#myTable tbody').append('<tr>' +
                        '<td><input type="checkbox" name="checkedIds" value="'+ response[i].id +'"></td>' +
                        '<td>' + response[i].id + '</td>' +
                        '<td>' + response[i].email + '</td>' +
                        '<td>' + response[i].firstName + ' ' + response[i].lastName + '</td>' +
                        '<td>' + response[i].regDate + '</td>' +
                        '<td>' + response[i].lastLoginDate + '</td>' +
                        '<td>' + response[i].enabled + '</td>' +
                        '<td>' + response[i].role.name + '</td>' +
                        '</tr>');
                }
            },
            error: function (error){
                console.log("error: " + error);
            }
        })
    }
    function deleteUser(){
        var checkedValues = [];
        $.each($("input[name='checkedIds']:checked"), function(){
            checkedValues.push($(this).val());
        });

        var data = 'id=' + checkedValues;
        $.ajax({
            url:"/delete",
            type: "POST",
            data: data,
            success: function (response){
                if(response == 'login'){
                    window.location.href = "/login";
                } else {
                    $("#myTable > tbody").html("");
                    $('#select-all').prop('checked', false);
                    for(var i=0;i<response.length;i++){
                        $('#myTable tbody').append('<tr>' +
                            '<td><input type="checkbox" name="checkedIds" value="'+ response[i].id +'"></td>' +
                            '<td>' + response[i].id + '</td>' +
                            '<td>' + response[i].email + '</td>' +
                            '<td>' + response[i].firstName + ' ' + response[i].lastName + '</td>' +
                            '<td>' + response[i].regDate + '</td>' +
                            '<td>' + response[i].lastLoginDate + '</td>' +
                            '<td>' + response[i].enabled + '</td>' +
                            '<td>' + response[i].role.name + '</td>' +
                            '</tr>');
                    }
                }
            },
            error: function (error){
                console.log("error: " + JSON.stringify(error));
            }
        })
    }
</script>
<style>
    .tableFixHead {
        overflow: auto;
        height: 60vh;
    }

    .tableFixHead thead th {
        position: sticky;
        top: 0;
        z-index: 1;
    }

    /* Just common table stuff. Really. */
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th,
    td {
        padding: 8px 16px;
    }

    th {
        background: #eee;
    }

</style>